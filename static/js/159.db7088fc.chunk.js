"use strict";(self.webpackChunkmidispatcher=self.webpackChunkmidispatcher||[]).push([[159],{31159:function(e,t,n){n.r(t),n.d(t,{ClockMachine:function(){return W}});var a,s,i,o,r,l,c,u,d,f,p,g,h=n(30168),m=n(70885),v=n(4942),k=n(1413),x=n(15671),y=n(43144),w=n(97326),Z=n(60136),b=n(27277),C=n(7894),j=n(29899),M=n(41896),O=n(48923),S=n(47313),T=n(93523),D=n(68097),A=n(47616),I=n(22089),U=n(46417),P=function(){var e,t=10;onmessage=function(n){"start"===n.data?e=setInterval((function(){postMessage("tick")}),t):n.data.interval?(t=n.data.interval,void 0!=e&&(clearInterval(e),e=setInterval((function(){postMessage("tick")}),n.data.interval))):"stop"===n.data&&(clearInterval(e),e=void 0)}}.toString(),B=P.substring(P.indexOf("{")+1,P.lastIndexOf("}")),L=new Blob([B],{type:"application/javascript"}),N=URL.createObjectURL(L),W=(0,I.xc)((s=function(e){(0,Z.Z)(n,e);var t=(0,b.Z)(n);function n(e){var a;if((0,x.Z)(this,n),(a=t.call(this)).state=void 0,a.audioContext=new AudioContext,a.position=0,a.turnedOff=!1,a.worker=void 0,a.state=null!==e&&void 0!==e?e:{tempo:110,status:"stop"},a.state=(0,k.Z)((0,k.Z)({},a.state),{},{status:"stop"}),0==n.instanceCounter&&window.Worker){var s=(0,w.Z)(a);a.worker=new Worker(N),a.worker.onmessage=function(e){"tick"===e.data&&n.tick(s)},a.worker.postMessage({interval:6e4/(24*a.state.tempo)})}return n.instanceCounter++,a.getNode().addMachineOutPort("Out",0),a}return(0,y.Z)(n,[{key:"hasWorker",value:function(){return void 0!=this.worker}},{key:"dispose",value:function(){var e;n.instanceCounter--,null===(e=this.worker)||void 0===e||e.terminate(),this.turnedOff=!0,this.emit(n.messages.stop,0)}},{key:"getFactory",value:function(){return n.factory}},{key:"setState",value:function(e){var t=this;void 0!=e.status&&(void 0!=this.worker&&this.worker.postMessage({interval:6e4/(24*e.tempo)}),this.state.status!==e.status&&this.emit(n.messages[e.status],0),"stop"===this.state.status&&"stop"!==e.status&&(void 0!=this.worker&&this.worker.postMessage("start"),this.position=0,setTimeout((function(){return n.tick(t)}),0)),"stop"===e.status&&(void 0!=this.worker&&this.worker.postMessage("stop"),this.emit(n.messages.allnotesoff,0),this.emit(n.messages.allsoundoff,0)),this.state=e)}},{key:"getState",value:function(){return this.state}}],[{key:"tick",value:function(e){if(!e.turnedOff&&(e.emit(n.messages.clock,0),void 0==e.worker)){0===e.position&&(e.position=1e3*e.audioContext.currentTime),e.position+=6e4/(24*e.state.tempo);var t=e.position-1e3*e.audioContext.currentTime;"stop"!==e.state.status&&setTimeout((function(){return n.tick(e)}),t)}}},{key:"buildFactory",value:function(){return this.factory||(this.factory={createMachine:function(e){return new n(e)},createWidget:function(e,t){return(0,U.jsx)(z,{engine:e,size:50,node:t,machine:t.machine})},getName:function(){return"ClockMachine"},getType:function(){return I.Ax.System},getTooltip:function(){return"Emits CLOCK message which can be used to command MIDI targets (on their system port) or Midispatcher's arpeggiator"},getMachineCode:function(){return"clock"}}),this.factory}}]),n}(I.Vs),s.instanceCounter=0,s.factory=void 0,s.messages=(i={},(0,v.Z)(i,"clock",{type:"clock",message:{rawData:Uint8Array.from([248]),isChannelMessage:!1,type:"clock",channel:0}}),(0,v.Z)(i,"start",{type:"start",message:{rawData:Uint8Array.from([250]),isChannelMessage:!1,type:"start",channel:0}}),(0,v.Z)(i,"continue",{type:"continue",message:{rawData:Uint8Array.from([251]),isChannelMessage:!1,type:"continue",channel:0}}),(0,v.Z)(i,"stop",{type:"stop",message:{rawData:Uint8Array.from([252]),isChannelMessage:!1,type:"stop",channel:0}}),(0,v.Z)(i,"allnotesoff",{type:"allnotesoff",message:{rawData:Uint8Array.from([176,123,0]),isChannelMessage:!0,type:"allnotesoff",channel:0}}),(0,v.Z)(i,"allsoundoff",{type:"allsoundoff",message:{rawData:Uint8Array.from([176,120,0]),isChannelMessage:!0,type:"allsoundoff",channel:0}}),i),a=s))||a,z=function(e){var t=S.useState(e.node.machine.getState()),n=(0,m.Z)(t,2),a=n[0],s=n[1];function i(t){e.machine.setState(t),s(t)}function o(t){e.node.setLocked(!t)}var r=e.machine.hasWorker()?" (main)":"";return(0,U.jsxs)(p.Body,{"data-default-node-name":e.node.getOptions().name,selected:e.node.isSelected(),background:e.node.getOptions().color,children:[(0,U.jsx)(p.Title,{children:(0,U.jsxs)(p.TitleName,{children:[e.node.getOptions().name,r]})}),(0,U.jsx)(p.Ports,{children:(0,U.jsx)(p.PortsContainer,{children:e.node.getOutPorts().map((function(t){return(0,U.jsx)(A.kL,{engine:e.engine,port:t},t.getID())}))})}),(0,U.jsxs)(p.SettingsBar,{children:[(0,U.jsxs)("span",{children:["Tempo: ",a.tempo]}),(0,U.jsxs)(p.Slider,{children:[(0,U.jsx)("input",{onMouseOver:function(e){return o(!1)},onMouseOut:function(e){return o(!0)},type:"range",min:"30",max:"240",step:"1",value:a.tempo,onChange:function(e){i((0,k.Z)((0,k.Z)({},a),{},{tempo:Number(e.target.value)}))},list:"tempos",name:"tempo"}),(0,U.jsx)("datalist",{id:"volumes",children:(0,U.jsx)("option",{value:"110",label:"Default"})})]}),(0,U.jsxs)(T.Z,{value:a.status,exclusive:!0,onChange:function(e,t){i((0,k.Z)((0,k.Z)({},a),{},{status:t}))},"aria-label":"text alignment",children:[(0,U.jsx)(D.Z,{value:"start","aria-label":"start",children:(0,U.jsx)(j.Z,{})}),(0,U.jsx)(D.Z,{value:"stop","aria-label":"stop",children:(0,U.jsx)(O.Z,{})}),(0,U.jsx)(D.Z,{value:"continue","aria-label":"continue",children:(0,U.jsx)(M.Z,{})})]})]})]})};(g=p||(p={})).Slider=C.default.div(o||(o=(0,h.Z)(["\n        vertical-align: middle;\n        input {\n\n            vertical-align: middle;\n        }\n        span {\n\n            vertical-align: middle;\n        }\n    "]))),g.SettingsBar=C.default.div(r||(r=(0,h.Z)(['\n        padding: 3px;\n        position: relative;\n        vertical-align: middle;\n        width: 100%;\n        display: flex;\n        justifyContent: "center";\n        flex-direction: column;\n    ']))),g.Title=C.default.div(l||(l=(0,h.Z)(["\n        background: rgba(0, 0, 0, 0.3);\n        display: flex;\n        white-space: nowrap;\n        justify-items: center;\n    "]))),g.TitleName=C.default.div(c||(c=(0,h.Z)(["\n        flex-grow: 1;\n        padding: 5px 5px;\n    "]))),g.Ports=C.default.div(u||(u=(0,h.Z)(["\n        display: flex;\n        background-image: linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.2));\n    "]))),g.PortsContainer=C.default.div(d||(d=(0,h.Z)(["\n        flex-grow: 1;\n        display: flex;\n        justify-content: flex-end;\n        &:first-of-type {\n\n            margin-right: 10px;\n        }\n        &:only-child {\n\n            margin-right: 0px;\n        }\n    "]))),g.Body=C.default.div(f||(f=(0,h.Z)(["\n        background-color: ",";\n        border-radius: 5px;\n        font-family: sans-serif;\n        color: white;\n        border: solid 2px black;\n        overflow: visible;\n        font-size: 11px;\n        border: solid 2px ",";\n\n    * {\n\n        box-sizing:border-box\n    }"])),(function(e){return e.background}),(function(e){return e.selected?"rgb(0,192,255)":"black"}))}}]);