"use strict";(self.webpackChunkmidispatcher=self.webpackChunkmidispatcher||[]).push([[980,159],{10980:function(e,t,n){n.r(t),n.d(t,{ArpMachine:function(){return E}});var i,a,o,s,r,l,c,d,u,f,p,h,g,v,m,x=n(30168),y=n(70885),k=n(1413),Z=n(15671),w=n(43144),b=n(60136),j=n(27277),C=n(7894),M=n(47313),S=n(45808),O=n(12215),I=n(90471),N=n(97180),T=n(57633),P=n(88993),D=n(89275),A=n(18104),V=n(94650),B=n(47616),U=n(31159),L=n(22089),z=n(46417),W={},E=(0,L.xc)((a=function(e){(0,b.Z)(n,e);var t=(0,j.Z)(n);function n(e){var i;return(0,Z.Z)(this,n),(i=t.call(this)).config=void 0,i.arpIndex=0,i.clockIndex=0,i.previousNote=void 0,i.config=null!==e&&void 0!==e?e:{notes:[],octaves:1,arpStyle:"up",notesToPlay:[]},i.getNode().addMachineInPort("Clock",0),i.getNode().addMachineOutPort("Out",0),i}return(0,w.Z)(n,[{key:"getFactory",value:function(){return n.factory}},{key:"setState",value:function(e){for(var t=e.notes.slice(),n=function(n){e.notes.forEach((function(e){return t.push({noteValue:e.noteValue,muted:e.muted,octave:e.octave+n})}))},i=1;i<e.octaves;i++)n(i);switch(e.arpStyle){case"down":t=t.reverse();break;case"updown":var a=t.slice();a.shift(),a.reverse(),a.shift(),t=t.concat(a);break;case"updown2":t=t.concat(t.slice().reverse())}this.arpIndex>=t.length&&(this.arpIndex=t.length-1),this.config.notes.length!==e.notes.length&&(this.clockIndex=0,this.arpIndex=0,void 0!=this.previousNote&&this.emit({message:{rawData:this.previousNote,isChannelMessage:!0,type:"noteoff",channel:0},type:"noteoff"},0),this.emit(U.ClockMachine.messages.stop,0)),this.config=(0,k.Z)((0,k.Z)({},e),{},{notesToPlay:t})}},{key:"getState",value:function(){return this.config}},{key:"receive",value:function(e,t,n){switch(e.type){case"start":n.setSending(!0),this.emit(e,0),this.arpIndex=0;break;case"stop":n.setSending(!0),this.clockIndex=0,void 0!=this.previousNote&&this.emit({message:{rawData:this.previousNote,isChannelMessage:!0,type:"noteoff",channel:0},type:"noteoff"},0),this.emit(e,0);break;case"clock":n.setSending(!0);var i=Math.floor(24/this.config.notes.length);if(0!==this.config.notes.length&&void 0!=this.emit&&(this.clockIndex=(this.clockIndex+1)%i,0===this.clockIndex)){var a=this.config.notesToPlay[this.arpIndex];if(void 0!=this.previousNote&&this.emit({message:{rawData:this.previousNote,isChannelMessage:!0,type:"noteoff",channel:0},type:"noteoff"},0),this.arpIndex="random"===this.config.arpStyle?Math.floor(Math.random()*this.config.notesToPlay.length):(this.arpIndex+1)%this.config.notesToPlay.length,a.muted)return;if(!W[a.noteValue+a.octave]){var o=S.dU.buildNote(a.noteValue+a.octave,{rawAttack:150});W[a.noteValue+a.octave]=Uint8Array.from([S.NT.MIDI_CHANNEL_MESSAGES.noteon<<4,o.getOffsetNumber(S.u5.octaveOffset),o.rawAttack])}var s=W[a.noteValue+a.octave];this.emit({message:{rawData:s,isChannelMessage:!0,type:"noteon",channel:0},type:"noteon"},0),this.previousNote=s}}}}],[{key:"buildFactory",value:function(){return this.factory||(this.factory={createMachine:function(e){return new n(e)},getName:function(){return"ArpMachine"},createWidget:function(e,t){return(0,z.jsx)(F,{engine:e,size:50,node:t,machine:t.machine})},getType:function(){return L.Ax.Emitter},getTooltip:function(){return"Reads CLOCK message and sends out arpeggiated notes ; add notes to the arpeggiato with the + button"},getMachineCode:function(){return"arp"}}),this.factory}}]),n}(L.Vs),a.factory=void 0,i=a))||i,F=function(e){var t=M.useState(e.machine.getState()),n=(0,y.Z)(t,2),i=n[0],a=n[1];function o(t){e.machine.setState(t),a(t)}function s(t){return(0,z.jsx)(B.kL,{engine:e.engine,port:t},t.getID())}function r(t){e.node.setLocked(!t)}function l(e){return V.ex.indexOf(e)}var c=i.notes.map((function(e,t){return(0,z.jsxs)(v.Note,{children:[(0,z.jsx)(P.ZP,{sx:{'& input[type="range"]':{WebkitAppearance:"slider-vertical"}},step:1,style:{marginTop:10,marginBottom:10},orientation:"vertical",defaultValue:0,max:11,value:l(e.noteValue),valueLabelDisplay:"off",onMouseOver:function(e){return r(!1)},onMouseOut:function(e){return r(!0)},onChange:function(e,n){"number"===typeof n&&(i.notes[t].noteValue=V.ex[n],o((0,k.Z)((0,k.Z)({},i),{},{notes:i.notes})))}}),(0,z.jsxs)(v.SettingsBarVertical,{style:{margin:0,padding:0},children:[(0,z.jsx)(D.Z,{"aria-label":"add note",icon:(0,z.jsx)(O.Z,{}),style:{margin:0,padding:0},checkedIcon:(0,z.jsx)(I.Z,{}),checked:!e.muted,onChange:function(e){i.notes[t].muted=!e.target.checked,o((0,k.Z)((0,k.Z)({},i),{},{notes:i.notes}))}}),(0,z.jsx)(A.Z,{"aria-label":"remove note",color:"error",size:"small",style:{margin:0,padding:0},onClick:function(){i.notes.splice(t,1),o((0,k.Z)((0,k.Z)({},i),{},{notes:i.notes}))},children:(0,z.jsx)(N.Z,{})})]}),e.noteValue+e.octave]},t)}));return(0,z.jsxs)(v.Body,{"data-default-node-name":e.node.getOptions().name,selected:e.node.isSelected(),background:e.node.getOptions().color,children:[(0,z.jsx)(v.Title,{children:(0,z.jsx)(v.TitleName,{children:e.node.getOptions().name})}),(0,z.jsxs)(v.Ports,{children:[(0,z.jsx)(v.PortsContainerIn,{children:e.node.getInPorts().map(s)}),(0,z.jsx)(v.PortsContainerOut,{children:e.node.getOutPorts().map(s)})]}),(0,z.jsxs)(v.SettingsBarHorizontal,{children:[(0,z.jsxs)(v.SettingsBarVertical,{children:[c,(0,z.jsx)(A.Z,{"aria-label":"add note",color:"primary",onClick:function(){return o((0,k.Z)((0,k.Z)({},i),{},{notes:i.notes.concat({muted:!1,noteValue:"C",octave:3})}))},children:(0,z.jsx)(T.Z,{})})]}),i.octaves+" octaves",(0,z.jsx)(P.ZP,{"aria-label":"Volume",min:1,max:4,onChange:function(e,t){"number"===typeof t&&o((0,k.Z)((0,k.Z)({},i),{},{octaves:t}))},value:i.octaves,onMouseOver:function(e){return r(!1)},onMouseOut:function(e){return r(!0)}}),(0,z.jsxs)(v.Dropdown,{children:[(0,z.jsx)("span",{children:"Style: "}),(0,z.jsxs)("select",{name:"arpstyle",value:i.arpStyle,onChange:function(e){o((0,k.Z)((0,k.Z)({},i),{},{arpStyle:e.target.value}))},children:[(0,z.jsx)("option",{value:"up",children:"Up"}),(0,z.jsx)("option",{value:"down",children:"Down"}),(0,z.jsx)("option",{value:"updown",children:"UpDown"}),(0,z.jsx)("option",{value:"updown2",children:"UpDown2"}),(0,z.jsx)("option",{value:"random",children:"Random"})]})]})]})]})};(m=v||(v={})).Dropdown=C.default.div(o||(o=(0,x.Z)(["\n        vertical-align: middle;\n        span {\n\n            vertical-align: middle;\n        }\n        input {\n\n            vertical-align: middle;\n        }\n    "]))),m.Slider=C.default.div(s||(s=(0,x.Z)(["\n        vertical-align: middle;\n        input {\n\n            vertical-align: middle;\n        }\n        span {\n\n            vertical-align: middle;\n        }\n    "]))),m.Title=C.default.div(r||(r=(0,x.Z)(["\n        background: rgba(0, 0, 0, 0.3);\n        display: flex;\n        white-space: nowrap;\n        justify-items: center;\n    "]))),m.TitleName=C.default.div(l||(l=(0,x.Z)(["\n        flex-grow: 1;\n        padding: 5px 5px;\n    "]))),m.Ports=C.default.div(c||(c=(0,x.Z)(["\n        display: flex;\n        background-image: linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.2));\n    "]))),m.PortsContainerOut=C.default.div(d||(d=(0,x.Z)(["\n        flex-grow: 1;\n        display: flex;\n        justify-content: flex-end;\n        &:first-of-type {\n\n            margin-right: 10px;\n        }\n        &:only-child {\n\n            margin-right: 0px;\n        }\n    "]))),m.PortsContainerIn=C.default.div(u||(u=(0,x.Z)(["\n        flex-grow: 1;\n        display: flex;\n        justify-content: flex-start;\n        &:first-of-type {\n\n            margin-right: 10px;\n        }\n        &:only-child {\n\n            margin-right: 0px;\n        }\n    "]))),m.Note=C.default.div(f||(f=(0,x.Z)(["\n        height: 200px;\n        position: relative;\n        vertical-align: middle;\n        width: 100%;\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n    "]))),m.SettingsBarVertical=C.default.div(p||(p=(0,x.Z)(['\n        position: relative;\n        vertical-align: middle;\n        width: 100%;\n        display: flex;\n        justifyContent: "down";\n        flex-direction: row;\n    ']))),m.SettingsBarHorizontal=C.default.div(h||(h=(0,x.Z)(['\n        position: relative;\n        vertical-align: middle;\n        width: 100%;\n        display: flex;\n        justifyContent: "down";\n        flex-direction: column;\n        padding: 10px;\n    ']))),m.Body=C.default.div(g||(g=(0,x.Z)(["\n        background-color: ",";\n        border-radius: 5px;\n        font-family: sans-serif;\n        color: white;\n        border: solid 2px black;\n        overflow: visible;\n        font-size: 11px;\n        border: solid 2px ",";\n\n    * {\n\n        box-sizing:border-box\n    }"])),(function(e){return e.background}),(function(e){return e.selected?"rgb(0,192,255)":"black"}))},31159:function(e,t,n){n.r(t),n.d(t,{ClockMachine:function(){return L}});var i,a,o,s,r,l,c,d,u,f,p,h,g=n(30168),v=n(70885),m=n(4942),x=n(1413),y=n(15671),k=n(43144),Z=n(97326),w=n(60136),b=n(27277),j=n(7894),C=n(29899),M=n(41896),S=n(48923),O=n(47313),I=n(93523),N=n(68097),T=n(47616),P=n(22089),D=n(46417),A=function(){var e,t=10;onmessage=function(n){"start"===n.data?e=setInterval((function(){postMessage("tick")}),t):n.data.interval?(t=n.data.interval,void 0!=e&&(clearInterval(e),e=setInterval((function(){postMessage("tick")}),n.data.interval))):"stop"===n.data&&(clearInterval(e),e=void 0)}}.toString(),V=A.substring(A.indexOf("{")+1,A.lastIndexOf("}")),B=new Blob([V],{type:"application/javascript"}),U=URL.createObjectURL(B),L=(0,P.xc)((a=function(e){(0,w.Z)(n,e);var t=(0,b.Z)(n);function n(e){var i;if((0,y.Z)(this,n),(i=t.call(this)).state=void 0,i.audioContext=new AudioContext,i.position=0,i.turnedOff=!1,i.worker=void 0,i.state=null!==e&&void 0!==e?e:{tempo:110,status:"stop"},i.state=(0,x.Z)((0,x.Z)({},i.state),{},{status:"stop"}),0==n.instanceCounter&&window.Worker){var a=(0,Z.Z)(i);i.worker=new Worker(U),i.worker.onmessage=function(e){"tick"===e.data&&n.tick(a)},i.worker.postMessage({interval:6e4/(24*i.state.tempo)})}return n.instanceCounter++,i.getNode().addMachineOutPort("Out",0),i}return(0,k.Z)(n,[{key:"hasWorker",value:function(){return void 0!=this.worker}},{key:"dispose",value:function(){var e;n.instanceCounter--,null===(e=this.worker)||void 0===e||e.terminate(),this.turnedOff=!0,this.emit(n.messages.stop,0)}},{key:"getFactory",value:function(){return n.factory}},{key:"setState",value:function(e){var t=this;void 0!=e.status&&(void 0!=this.worker&&this.worker.postMessage({interval:6e4/(24*e.tempo)}),this.state.status!==e.status&&this.emit(n.messages[e.status],0),"stop"===this.state.status&&"stop"!==e.status&&(void 0!=this.worker&&this.worker.postMessage("start"),this.position=0,setTimeout((function(){return n.tick(t)}),0)),"stop"===e.status&&(void 0!=this.worker&&this.worker.postMessage("stop"),this.emit(n.messages.allnotesoff,0),this.emit(n.messages.allsoundoff,0)),this.state=e)}},{key:"getState",value:function(){return this.state}}],[{key:"tick",value:function(e){if(!e.turnedOff&&(e.emit(n.messages.clock,0),void 0==e.worker)){0===e.position&&(e.position=1e3*e.audioContext.currentTime),e.position+=6e4/(24*e.state.tempo);var t=e.position-1e3*e.audioContext.currentTime;"stop"!==e.state.status&&setTimeout((function(){return n.tick(e)}),t)}}},{key:"buildFactory",value:function(){return this.factory||(this.factory={createMachine:function(e){return new n(e)},createWidget:function(e,t){return(0,D.jsx)(z,{engine:e,size:50,node:t,machine:t.machine})},getName:function(){return"ClockMachine"},getType:function(){return P.Ax.System},getTooltip:function(){return"Emits CLOCK message which can be used to command MIDI targets (on their system port) or Midispatcher's arpeggiator"},getMachineCode:function(){return"clock"}}),this.factory}}]),n}(P.Vs),a.instanceCounter=0,a.factory=void 0,a.messages=(o={},(0,m.Z)(o,"clock",{type:"clock",message:{rawData:Uint8Array.from([248]),isChannelMessage:!1,type:"clock",channel:0}}),(0,m.Z)(o,"start",{type:"start",message:{rawData:Uint8Array.from([250]),isChannelMessage:!1,type:"start",channel:0}}),(0,m.Z)(o,"continue",{type:"continue",message:{rawData:Uint8Array.from([251]),isChannelMessage:!1,type:"continue",channel:0}}),(0,m.Z)(o,"stop",{type:"stop",message:{rawData:Uint8Array.from([252]),isChannelMessage:!1,type:"stop",channel:0}}),(0,m.Z)(o,"allnotesoff",{type:"allnotesoff",message:{rawData:Uint8Array.from([176,123,0]),isChannelMessage:!0,type:"allnotesoff",channel:0}}),(0,m.Z)(o,"allsoundoff",{type:"allsoundoff",message:{rawData:Uint8Array.from([176,120,0]),isChannelMessage:!0,type:"allsoundoff",channel:0}}),o),i=a))||i,z=function(e){var t=O.useState(e.node.machine.getState()),n=(0,v.Z)(t,2),i=n[0],a=n[1];function o(t){e.machine.setState(t),a(t)}function s(t){e.node.setLocked(!t)}var r=e.machine.hasWorker()?" (main)":"";return(0,D.jsxs)(p.Body,{"data-default-node-name":e.node.getOptions().name,selected:e.node.isSelected(),background:e.node.getOptions().color,children:[(0,D.jsx)(p.Title,{children:(0,D.jsxs)(p.TitleName,{children:[e.node.getOptions().name,r]})}),(0,D.jsx)(p.Ports,{children:(0,D.jsx)(p.PortsContainer,{children:e.node.getOutPorts().map((function(t){return(0,D.jsx)(T.kL,{engine:e.engine,port:t},t.getID())}))})}),(0,D.jsxs)(p.SettingsBar,{children:[(0,D.jsxs)("span",{children:["Tempo: ",i.tempo]}),(0,D.jsxs)(p.Slider,{children:[(0,D.jsx)("input",{onMouseOver:function(e){return s(!1)},onMouseOut:function(e){return s(!0)},type:"range",min:"30",max:"240",step:"1",value:i.tempo,onChange:function(e){o((0,x.Z)((0,x.Z)({},i),{},{tempo:Number(e.target.value)}))},list:"tempos",name:"tempo"}),(0,D.jsx)("datalist",{id:"volumes",children:(0,D.jsx)("option",{value:"110",label:"Default"})})]}),(0,D.jsxs)(I.Z,{value:i.status,exclusive:!0,onChange:function(e,t){o((0,x.Z)((0,x.Z)({},i),{},{status:t}))},"aria-label":"text alignment",children:[(0,D.jsx)(N.Z,{value:"start","aria-label":"start",children:(0,D.jsx)(C.Z,{})}),(0,D.jsx)(N.Z,{value:"stop","aria-label":"stop",children:(0,D.jsx)(S.Z,{})}),(0,D.jsx)(N.Z,{value:"continue","aria-label":"continue",children:(0,D.jsx)(M.Z,{})})]})]})]})};(h=p||(p={})).Slider=j.default.div(s||(s=(0,g.Z)(["\n        vertical-align: middle;\n        input {\n\n            vertical-align: middle;\n        }\n        span {\n\n            vertical-align: middle;\n        }\n    "]))),h.SettingsBar=j.default.div(r||(r=(0,g.Z)(['\n        padding: 3px;\n        position: relative;\n        vertical-align: middle;\n        width: 100%;\n        display: flex;\n        justifyContent: "center";\n        flex-direction: column;\n    ']))),h.Title=j.default.div(l||(l=(0,g.Z)(["\n        background: rgba(0, 0, 0, 0.3);\n        display: flex;\n        white-space: nowrap;\n        justify-items: center;\n    "]))),h.TitleName=j.default.div(c||(c=(0,g.Z)(["\n        flex-grow: 1;\n        padding: 5px 5px;\n    "]))),h.Ports=j.default.div(d||(d=(0,g.Z)(["\n        display: flex;\n        background-image: linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.2));\n    "]))),h.PortsContainer=j.default.div(u||(u=(0,g.Z)(["\n        flex-grow: 1;\n        display: flex;\n        justify-content: flex-end;\n        &:first-of-type {\n\n            margin-right: 10px;\n        }\n        &:only-child {\n\n            margin-right: 0px;\n        }\n    "]))),h.Body=j.default.div(f||(f=(0,g.Z)(["\n        background-color: ",";\n        border-radius: 5px;\n        font-family: sans-serif;\n        color: white;\n        border: solid 2px black;\n        overflow: visible;\n        font-size: 11px;\n        border: solid 2px ",";\n\n    * {\n\n        box-sizing:border-box\n    }"])),(function(e){return e.background}),(function(e){return e.selected?"rgb(0,192,255)":"black"}))}}]);